<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Premier League Appearances Quiz</title>
  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background: #0b0f1a; color: #fff; }
    .wrap { min-height:100%; display:flex; align-items:center; justify-content:center; padding: 16px; }
    .card {
      width: min(880px, 100%);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: rgba(255,255,255,.04);
      box-shadow: 0 16px 50px rgba(0,0,0,.45);
      overflow:hidden;
    }
    header {
      display:flex; justify-content:space-between; align-items:center; gap: 12px;
      padding: 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      flex-wrap: wrap;
    }
    .title { font-weight: 800; letter-spacing: .2px; }
    .meta { display:flex; gap: 10px; align-items:center; flex-wrap: wrap; justify-content:flex-end; }
    .pill {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-size: 13px;
      white-space: nowrap;
    }
    .btn {
      cursor:pointer;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color:#fff;
      font-weight: 700;
    }
    .btn:hover { background: rgba(255,255,255,.12); }
    .btn:disabled { opacity: .55; cursor:not-allowed; }
    main { padding: 16px; }
    .grid { display:grid; grid-template-columns: 1fr; gap: 14px; }
    @media (min-width: 760px) {
      .grid { grid-template-columns: 1fr 1fr; }
    }
    .choice {
      padding: 16px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      display:flex; flex-direction: column; gap: 10px;
      min-height: 140px;
    }
    .name { font-size: 20px; font-weight: 800; line-height: 1.2; }
    .sub { opacity: .85; font-size: 13px; }
    .bigbtn { margin-top:auto; width: 100%; padding: 12px 14px; font-size: 16px; }
    .center { text-align:center; }
    .status {
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      line-height: 1.45;
    }
    .ok { border-color: rgba(60,255,140,.35); background: rgba(60,255,140,.08); }
    .bad { border-color: rgba(255,80,80,.35); background: rgba(255,80,80,.08); }
    .muted { opacity: .75; }
    .row { display:flex; gap: 10px; align-items:center; justify-content:center; flex-wrap: wrap; margin-top: 12px; }
    .small { font-size: 12px; opacity: .8; }
    a { color: #b9d4ff; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="title">⚽ Premier League Appearances: Who Has More?</div>
        <div class="meta">
          <div class="pill" id="dataPill">Data: loading…</div>
          <div class="pill" id="scorePill">Score: 0</div>
          <div class="pill" id="streakPill">Streak: 0</div>
          <div class="pill" id="bestPill">Best: 0</div>
          <button class="btn" id="newBtn">New Question</button>
          <button class="btn" id="resetBtn">Reset</button>
        </div>
      </header>

      <main>
        <div class="center muted" id="prompt">Loading players…</div>

        <div class="grid" style="margin-top:14px;">
          <div class="choice">
            <div class="name" id="nameA">—</div>
            <div class="sub" id="teamA">—</div>
            <button class="btn bigbtn" id="btnA" disabled>Choose A</button>
          </div>

          <div class="choice">
            <div class="name" id="nameB">—</div>
            <div class="sub" id="teamB">—</div>
            <button class="btn bigbtn" id="btnB" disabled>Choose B</button>
          </div>
        </div>

        <div id="status" class="status muted" style="display:none;"></div>

        <div class="row">
          <label class="pill" style="display:flex; gap:8px; align-items:center;">
            <input type="checkbox" id="hardMode" />
            Hard mode (hide clubs)
          </label>
          <label class="pill" style="display:flex; gap:8px; align-items:center;">
            <input type="checkbox" id="closeMode" />
            Close mode (prefer similar totals)
          </label>
        </div>

        <div class="center small" style="margin-top:10px;">
          Source idea: Premier League stats pages load ranked player stats as JSON from PulseLive endpoints. If live loading fails due to CORS, this game uses a small built-in fallback list.
        </div>
      </main>
    </div>
  </div>

<script>
(() => {
  // PulseLive endpoint pattern used for PL ranked player stats (example shown for goals on Stack Overflow).
  // We swap "goals" -> "appearances". :contentReference[oaicite:1]{index=1}
  const LIVE_URL =
    "https://footballapi.pulselive.com/football/stats/ranked/players/appearances" +
    "?page=0&pageSize=1000&comps=1&compCodeForActivePlayer=EN_PR&altIds=true";

  // Small fallback list (game still works if the browser blocks cross-origin requests from your host).
  // You can expand this manually if you want.
  const FALLBACK = [
    { name: "Gareth Barry", value: 653, team: "—" },
    { name: "James Milner", value: 638, team: "—" },
    { name: "Ryan Giggs", value: 632, team: "—" },
    { name: "Frank Lampard", value: 611, team: "—" },
    { name: "David James", value: 572, team: "—" },
    { name: "Gary Speed", value: 535, team: "—" },
    { name: "Emile Heskey", value: 516, team: "—" },
    { name: "Mark Schwarzer", value: 514, team: "—" },
    { name: "Jamie Carragher", value: 508, team: "—" },
    { name: "Phil Neville", value: 505, team: "—" }
  ];

  // UI
  const el = (id) => document.getElementById(id);
  const dataPill = el("dataPill");
  const scorePill = el("scorePill");
  const streakPill = el("streakPill");
  const bestPill = el("bestPill");
  const prompt = el("prompt");
  const status = el("status");
  const nameA = el("nameA");
  const nameB = el("nameB");
  const teamA = el("teamA");
  const teamB = el("teamB");
  const btnA = el("btnA");
  const btnB = el("btnB");
  const newBtn = el("newBtn");
  const resetBtn = el("resetBtn");
  const hardMode = el("hardMode");
  const closeMode = el("closeMode");

  // State
  let players = [];
  let current = null;
  let locked = false;

  let score = 0;
  let streak = 0;
  let best = Number(localStorage.getItem("pl_best_streak") || 0);

  bestPill.textContent = `Best: ${best}`;
  scorePill.textContent = `Score: ${score}`;
  streakPill.textContent = `Streak: ${streak}`;

  function setStatus(msg, kind) {
    status.style.display = "block";
    status.className = "status " + (kind || "");
    status.textContent = msg;
  }
  function clearStatus() {
    status.style.display = "none";
    status.textContent = "";
    status.className = "status muted";
  }

  function normalizeFromApi(item) {
    // Typical shape (from examples in StackOverflow posts): stats.content items have:
    // item.value, and item.owner.name.display, item.owner.currentTeam... :contentReference[oaicite:2]{index=2}
    const owner = item.owner || {};
    const teamObj = owner.currentTeam || owner.currentTeam?.club || {};
    const teamName =
      (owner.currentTeam && (owner.currentTeam.shortName || owner.currentTeam.name)) ||
      (owner.currentTeam && owner.currentTeam.club && (owner.currentTeam.club.name || owner.currentTeam.club.abbr)) ||
      "—";

    return {
      name: owner.name?.display || owner.name?.first + " " + owner.name?.last || "Unknown",
      value: Number(item.value || 0),
      team: teamName
    };
  }

  async function loadPlayers() {
    // Try live first
    try {
      const res = await fetch(LIVE_URL, { method: "GET" });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      const json = await res.json();

      const content = json?.stats?.content;
      if (!Array.isArray(content) || content.length < 20) {
        throw new Error("Unexpected payload");
      }

      players = content.map(normalizeFromApi).filter(p => p.value > 0 && p.name && p.name !== "Unknown");
      dataPill.textContent = `Data: live (${players.length} players)`;
      prompt.textContent = "Who has more Premier League appearances?";
      return;
    } catch (e) {
      // Fallback
      players = FALLBACK.slice();
      dataPill.textContent = `Data: fallback (${players.length} players)`;
      prompt.textContent = "Who has more Premier League appearances? (fallback list)";
      setStatus("Live data load failed (likely CORS from your host). Using fallback list.", "muted");
    }
  }

  function pickTwo() {
    if (players.length < 2) return null;

    // If close mode is on, try a few times to find two players with similar totals (harder question).
    const tries = closeMode.checked ? 40 : 1;
    let bestPair = null;
    let bestDiff = Infinity;

    for (let t = 0; t < tries; t++) {
      const a = players[Math.floor(Math.random() * players.length)];
      let b = players[Math.floor(Math.random() * players.length)];
      while (b === a) b = players[Math.floor(Math.random() * players.length)];

      const diff = Math.abs(a.value - b.value);
      if (!bestPair || diff < bestDiff) {
        bestPair = { a, b };
        bestDiff = diff;
      }
      if (!closeMode.checked) break;
      if (bestDiff === 0) break;
    }
    return bestPair;
  }

  function renderQuestion() {
    locked = false;
    clearStatus();
    const pair = pickTwo();
    if (!pair) {
      prompt.textContent = "Not enough data to play.";
      return;
    }
    current = pair;

    nameA.textContent = pair.a.name;
    nameB.textContent = pair.b.name;

    const hideTeams = hardMode.checked;
    teamA.textContent = hideTeams ? "Club: hidden" : `Club: ${pair.a.team || "—"}`;
    teamB.textContent = hideTeams ? "Club: hidden" : `Club: ${pair.b.team || "—"}`;

    btnA.disabled = false;
    btnB.disabled = false;
  }

  function endRound(chosen) {
    if (locked || !current) return;
    locked = true;

    btnA.disabled = true;
    btnB.disabled = true;

    const a = current.a, b = current.b;
    const correct = (a.value === b.value)
      ? "tie"
      : (a.value > b.value ? "A" : "B");

    let msg = "";
    let kind = "";

    if (correct === "tie") {
      msg = `It’s a tie! ${a.name}: ${a.value} • ${b.name}: ${b.value}. (No streak change)`;
      kind = "ok";
    } else if (chosen === correct) {
      streak += 1;
      score += 1;
      msg = `✅ Correct! ${a.name}: ${a.value} • ${b.name}: ${b.value}.`;
      kind = "ok";
    } else {
      streak = 0;
      msg = `❌ Wrong. ${a.name}: ${a.value} • ${b.name}: ${b.value}.`;
      kind = "bad";
    }

    if (streak > best) {
      best = streak;
      localStorage.setItem("pl_best_streak", String(best));
    }

    scorePill.textContent = `Score: ${score}`;
    streakPill.textContent = `Streak: ${streak}`;
    bestPill.textContent = `Best: ${best}`;

    setStatus(msg, kind);
  }

  btnA.addEventListener("click", () => endRound("A"));
  btnB.addEventListener("click", () => endRound("B"));

  newBtn.addEventListener("click", () => renderQuestion());

  resetBtn.addEventListener("click", () => {
    score = 0; streak = 0;
    scorePill.textContent = `Score: ${score}`;
    streakPill.textContent = `Streak: ${streak}`;
    clearStatus();
    renderQuestion();
  });

  hardMode.addEventListener("change", () => {
    if (current) {
      teamA.textContent = hardMode.checked ? "Club: hidden" : `Club: ${current.a.team || "—"}`;
      teamB.textContent = hardMode.checked ? "Club: hidden" : `Club: ${current.b.team || "—"}`;
    }
  });

  // Init
  (async () => {
    await loadPlayers();
    renderQuestion();
  })();
})();
</script>
</body>
</html>
